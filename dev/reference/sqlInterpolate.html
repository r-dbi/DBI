<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Safely interpolate values into an SQL string — sqlInterpolate • DBI</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Safely interpolate values into an SQL string — sqlInterpolate"><meta name="description" content='Accepts a query string with placeholders for values, and returns a string
with the values embedded.
The function is careful to quote all of its inputs with dbQuoteLiteral()
to protect against SQL injection attacks.
Placeholders can be specified with one of two syntaxes:
?: each occurrence of a standalone ? is replaced with a value
?name1, ?name2, ...: values are given as named arguments or a
named list, the names are used to match the values


Mixing ? and ?name syntaxes is an error.
The number and names of values supplied must correspond to the placeholders
used in the query.

Methods in other packagesThis documentation page describes the generics. Refer to the documentation pages linked below for the documentation for the methods that are implemented in various backend packages.
pool::sqlInterpolate("Pool")
sparklyr::sqlInterpolate("spark_connection")

'><meta property="og:description" content='Accepts a query string with placeholders for values, and returns a string
with the values embedded.
The function is careful to quote all of its inputs with dbQuoteLiteral()
to protect against SQL injection attacks.
Placeholders can be specified with one of two syntaxes:
?: each occurrence of a standalone ? is replaced with a value
?name1, ?name2, ...: values are given as named arguments or a
named list, the names are used to match the values


Mixing ? and ?name syntaxes is an error.
The number and names of values supplied must correspond to the placeholders
used in the query.

Methods in other packagesThis documentation page describes the generics. Refer to the documentation pages linked below for the documentation for the methods that are implemented in various backend packages.
pool::sqlInterpolate("Pool")
sparklyr::sqlInterpolate("spark_connection")

'><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DBI</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.3.9019</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/DBI.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-dbi/DBI/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Safely interpolate values into an SQL string</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-dbi/DBI/blob/main/R/sqlInterpolate.R" class="external-link"><code>R/sqlInterpolate.R</code></a></small>
      <div class="d-none name"><code>sqlInterpolate.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Accepts a query string with placeholders for values, and returns a string
with the values embedded.
The function is careful to quote all of its inputs with <code><a href="dbQuoteLiteral.html">dbQuoteLiteral()</a></code>
to protect against SQL injection attacks.</p>
<p>Placeholders can be specified with one of two syntaxes:</p><ul><li><p><code>?</code>: each occurrence of a standalone <code>?</code> is replaced with a value</p></li>
<li><p><code>?name1</code>, <code>?name2</code>, ...: values are given as named arguments or a
named list, the names are used to match the values</p></li>
</ul><p>Mixing <code>?</code> and <code><a href="https://rdrr.io/r/base/name.html" class="external-link">?name</a></code> syntaxes is an error.
The number and names of values supplied must correspond to the placeholders
used in the query.</p>
<p></p><div class="section">
<h3 id="methods-in-other-packages">Methods in other packages<a class="anchor" aria-label="anchor" href="#methods-in-other-packages"></a></h3><p>This documentation page describes the generics. Refer to the documentation pages linked below for the documentation for the methods that are implemented in various backend packages.</p><ul><li><p><code><a href="http://rstudio.github.io/pool/reference/DBI-wrap.html" class="external-link">pool::sqlInterpolate("Pool")</a></code></p></li>
<li><p><code>sparklyr::sqlInterpolate("spark_connection")</code></p></li>
</ul></div>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sqlInterpolate</span><span class="op">(</span><span class="va">conn</span>, <span class="va">sql</span>, <span class="va">...</span>, .dots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-conn">conn<a class="anchor" aria-label="anchor" href="#arg-conn"></a></dt>
<dd><p>A <a href="DBIConnection-class.html">DBIConnection</a> object, as returned by
<code><a href="dbConnect.html">dbConnect()</a></code>.</p></dd>


<dt id="arg-sql">sql<a class="anchor" aria-label="anchor" href="#arg-sql"></a></dt>
<dd><p>A SQL string containing variables to interpolate.
Variables must start with a question mark and can be any valid R
identifier, i.e. it must start with a letter or <code>.</code>, and be followed
by a letter, digit, <code>.</code> or <code>_</code>.</p></dd>


<dt id="arg--dots">..., .dots<a class="anchor" aria-label="anchor" href="#arg--dots"></a></dt>
<dd><p>Values (for <code>...</code>) or a list (for <code>.dots</code>)
to interpolate into a string.
Names are required if  <code>sql</code> uses the <code><a href="https://rdrr.io/r/base/name.html" class="external-link">?name</a></code> syntax for placeholders.
All values will be first escaped with <code><a href="dbQuoteLiteral.html">dbQuoteLiteral()</a></code> prior
to interpolation to protect against SQL injection attacks.
Arguments created by <code><a href="SQL.html">SQL()</a></code> or <code><a href="dbQuoteIdentifier.html">dbQuoteIdentifier()</a></code> remain unchanged.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The <code>sql</code> query with the values from <code>...</code> and <code>.dots</code> safely
embedded.</p>
    </div>
    <div class="section level2">
    <h2 id="backend-authors">Backend authors<a class="anchor" aria-label="anchor" href="#backend-authors"></a></h2>


<p>If you are implementing an SQL backend with non-ANSI quoting rules, you'll
need to implement a method for <code><a href="sqlParseVariables.html">sqlParseVariables()</a></code>. Failure to
do so does not expose you to SQL injection attacks, but will (rarely) result
in errors matching supplied and interpolated variables.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">sql</span> <span class="op">&lt;-</span> <span class="st">"SELECT * FROM X WHERE name = ?name"</span></span></span>
<span class="r-in"><span><span class="fu">sqlInterpolate</span><span class="op">(</span><span class="fu"><a href="ANSI.html">ANSI</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">sql</span>, name <span class="op">=</span> <span class="st">"Hadley"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;SQL&gt; SELECT * FROM X WHERE name = 'Hadley'</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># This is safe because the single quote has been double escaped</span></span></span>
<span class="r-in"><span><span class="fu">sqlInterpolate</span><span class="op">(</span><span class="fu"><a href="ANSI.html">ANSI</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">sql</span>, name <span class="op">=</span> <span class="st">"H'); DROP TABLE--;"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;SQL&gt; SELECT * FROM X WHERE name = 'H''); DROP TABLE--;'</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using paste0() could lead to dangerous SQL with carefully crafted inputs</span></span></span>
<span class="r-in"><span><span class="co"># (SQL injection)</span></span></span>
<span class="r-in"><span><span class="va">name</span> <span class="op">&lt;-</span> <span class="st">"H'); DROP TABLE--;"</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"SELECT * FROM X WHERE name = '"</span>, <span class="va">name</span>, <span class="st">"'"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "SELECT * FROM X WHERE name = 'H'); DROP TABLE--;'"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use SQL() or dbQuoteIdentifier() to avoid escaping</span></span></span>
<span class="r-in"><span><span class="va">sql2</span> <span class="op">&lt;-</span> <span class="st">"SELECT * FROM ?table WHERE name in ?names"</span></span></span>
<span class="r-in"><span><span class="fu">sqlInterpolate</span><span class="op">(</span><span class="fu"><a href="ANSI.html">ANSI</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">sql2</span>,</span></span>
<span class="r-in"><span>  table <span class="op">=</span> <span class="fu"><a href="dbQuoteIdentifier.html">dbQuoteIdentifier</a></span><span class="op">(</span><span class="fu"><a href="ANSI.html">ANSI</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"X"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  names <span class="op">=</span> <span class="fu"><a href="SQL.html">SQL</a></span><span class="op">(</span><span class="st">"('a', 'b')"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;SQL&gt; SELECT * FROM "X" WHERE name in ('a', 'b')</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Don't use SQL() to escape identifiers to avoid SQL injection</span></span></span>
<span class="r-in"><span><span class="fu">sqlInterpolate</span><span class="op">(</span><span class="fu"><a href="ANSI.html">ANSI</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">sql2</span>,</span></span>
<span class="r-in"><span>  table <span class="op">=</span> <span class="fu"><a href="SQL.html">SQL</a></span><span class="op">(</span><span class="st">"X; DELETE FROM X; SELECT * FROM X"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  names <span class="op">=</span> <span class="fu"><a href="SQL.html">SQL</a></span><span class="op">(</span><span class="st">"('a', 'b')"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;SQL&gt; SELECT * FROM X; DELETE FROM X; SELECT * FROM X WHERE name in ('a', 'b')</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use dbGetQuery() or dbExecute() to process these queries:</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"RSQLite"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="dbConnect.html">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">sql</span> <span class="op">&lt;-</span> <span class="st">"SELECT ?value AS value"</span></span></span>
<span class="r-in"><span>  <span class="va">query</span> <span class="op">&lt;-</span> <span class="fu">sqlInterpolate</span><span class="op">(</span><span class="va">con</span>, <span class="va">sql</span>, value <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="dbGetQuery.html">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="va">query</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="dbDisconnect.html">dbDisconnect</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     3</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by R Special Interest Group on Databases (R-SIG-DB), <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://krlmlr.info" class="external-link">Kirill Müller</a>, R Consortium.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer></div>





  </body></html>


<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using DBI with Arrow • DBI</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using DBI with Arrow">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DBI</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.3.9008</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/DBI.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-dbi/DBI/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using DBI with Arrow</h1>
                        <h4 data-toc-skip class="author">Kirill
Müller</h4>
            
            <h4 data-toc-skip class="date">25/12/2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/r-dbi/DBI/blob/main/vignettes/DBI-arrow.Rmd" class="external-link"><code>vignettes/DBI-arrow.Rmd</code></a></small>
      <div class="d-none name"><code>DBI-arrow.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="who-this-tutorial-is-for">Who this tutorial is for<a class="anchor" aria-label="anchor" href="#who-this-tutorial-is-for"></a>
</h2>
<p>This tutorial is for you if you want to leverage <a href="https://arrow.apache.org/" class="external-link">Apache Arrow</a> for accessing and
manipulating data on databases. See
<code><a href="../articles/DBI.html">vignette("DBI", package = "DBI")</a></code> and
<code><a href="../articles/DBI-advanced.html">vignette("DBI-advanced", package = "DBI")</a></code> for tutorials on
accessing data using R’s data frames instead of Arrow’s structures.</p>
</div>
<div class="section level2">
<h2 id="rationale">Rationale<a class="anchor" aria-label="anchor" href="#rationale"></a>
</h2>
<p>Apache Arrow is</p>
<blockquote>
<p>a cross-language development platform for in-memory analytics,</p>
</blockquote>
<p>suitable for large and huge data, with support for out-of-memory
operation. Arrow is also a data exchange format, the data types covered
by Arrow align well with the data types supported by SQL databases.</p>
<p>DBI 1.2.0 introduced support for Arrow as a format for exchanging
data between R and databases. The aim is to:</p>
<ul>
<li>accelerate data retrieval and loading, by using fewer costly data
conversions;</li>
<li>better support reading and summarizing data from a database that is
larger than memory;</li>
<li>provide better type fidelity with workflows centered around
Arrow.</li>
</ul>
<p>This allows existing code to be used with Arrow, and it allows new
code to be written that is more efficient and more flexible than code
that uses R’s data frames.</p>
<p>The interface is built around the {nanoarrow} R package, with
<code><a href="https://arrow.apache.org/nanoarrow/latest/r/reference/as_nanoarrow_array.html" class="external-link">nanoarrow::as_nanoarrow_array</a></code> and
<code><a href="https://arrow.apache.org/nanoarrow/latest/r/reference/as_nanoarrow_array_stream.html" class="external-link">nanoarrow::as_nanoarrow_array_stream</a></code> as fundamental data
structures.</p>
</div>
<div class="section level2">
<h2 id="new-classes-and-generics">New classes and generics<a class="anchor" aria-label="anchor" href="#new-classes-and-generics"></a>
</h2>
<p>DBI 1.2.0 introduces new classes and generics for working with Arrow
data:</p>
<ul>
<li><code><a href="../reference/dbReadTableArrow.html">dbReadTableArrow()</a></code></li>
<li><code><a href="../reference/dbWriteTableArrow.html">dbWriteTableArrow()</a></code></li>
<li><code><a href="../reference/dbCreateTableArrow.html">dbCreateTableArrow()</a></code></li>
<li><code><a href="../reference/dbAppendTableArrow.html">dbAppendTableArrow()</a></code></li>
<li><code><a href="../reference/dbGetQueryArrow.html">dbGetQueryArrow()</a></code></li>
<li><code><a href="../reference/dbSendQueryArrow.html">dbSendQueryArrow()</a></code></li>
<li><code><a href="../reference/dbBind.html">dbBindArrow()</a></code></li>
<li><code><a href="../reference/dbFetchArrow.html">dbFetchArrow()</a></code></li>
<li><code><a href="../reference/dbFetchArrowChunk.html">dbFetchArrowChunk()</a></code></li>
<li><code>DBIResultArrow-class</code></li>
<li><code>DBIResultArrowDefault-class</code></li>
</ul>
<p>Compatibility is important for DBI, and implementing new generics and
classes greatly reduces the risk of breaking existing code. The DBI
package comes with a fully functional fallback implementation for all
existing DBI backends. The fallback is not improving performance, but it
allows existing code to be used with Arrow before switching to a backend
with native Arrow support. Backends with native support, like the <a href="https://adbi.r-dbi.org/" class="external-link">adbi</a> package, implement the new
generics and classes for direct support and improved performance.</p>
<p>In the remainder of this tutorial, we will demonstrate the new
generics and classes using the RSQLite package. SQLite is an in-memory
database, this code does not need a database server to be installed and
running.</p>
</div>
<div class="section level2">
<h2 id="prepare">Prepare<a class="anchor" aria-label="anchor" href="#prepare"></a>
</h2>
<p>We start by setting up a database connection and creating a table
with some data, using the original <code><a href="../reference/dbWriteTable.html">dbWriteTable()</a></code>
method.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org">DBI</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbConnect.html">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>  b <span class="op">=</span> <span class="fl">4.5</span>,</span>
<span>  c <span class="op">=</span> <span class="st">"five"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/dbWriteTable.html">dbWriteTable</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"tbl"</span>, <span class="va">data</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="read-all-rows-from-a-table">Read all rows from a table<a class="anchor" aria-label="anchor" href="#read-all-rows-from-a-table"></a>
</h2>
<p>The <code><a href="../reference/dbReadTableArrow.html">dbReadTableArrow()</a></code> method reads all rows from a
table into an Arrow stream, similarly to <code><a href="../reference/dbReadTable.html">dbReadTable()</a></code>.
Arrow objects implement the <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code> method, so we
can convert the stream to a data frame.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stream</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbReadTableArrow.html">dbReadTableArrow</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"tbl"</span><span class="op">)</span></span>
<span><span class="va">stream</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;nanoarrow_array_stream struct&lt;a: int32, b: double, c: string&gt;&gt;</span></span>
<span><span class="co">##  $ get_schema:function ()  </span></span>
<span><span class="co">##  $ get_next  :function (schema = x$get_schema(), validate = TRUE)  </span></span>
<span><span class="co">##  $ release   :function ()</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">stream</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   a   b    c</span></span>
<span><span class="co">## 1 1 4.5 five</span></span>
<span><span class="co">## 2 2 4.5 five</span></span>
<span><span class="co">## 3 3 4.5 five</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="run-queries">Run queries<a class="anchor" aria-label="anchor" href="#run-queries"></a>
</h2>
<p>The <code><a href="../reference/dbGetQueryArrow.html">dbGetQueryArrow()</a></code> method runs a query and returns
the result as an Arrow stream. This stream can be turned into an
<code><a href="https://arrow.apache.org/docs/r/reference/RecordBatchReader.html" class="external-link">arrow::RecordBatchReader</a></code> object and processed further,
without bringing it into R.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stream</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetQueryArrow.html">dbGetQueryArrow</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT COUNT(*) AS n FROM tbl WHERE a &lt; 3"</span><span class="op">)</span></span>
<span><span class="va">stream</span></span></code></pre></div>
<pre><code><span><span class="co">## &lt;nanoarrow_array_stream struct&lt;n: int32&gt;&gt;</span></span>
<span><span class="co">##  $ get_schema:function ()  </span></span>
<span><span class="co">##  $ get_next  :function (schema = x$get_schema(), validate = TRUE)  </span></span>
<span><span class="co">##  $ release   :function ()</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".parquet"</span><span class="op">)</span></span>
<span><span class="fu">arrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/docs/r/reference/write_parquet.html" class="external-link">write_parquet</a></span><span class="op">(</span><span class="fu">arrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/docs/r/reference/as_record_batch_reader.html" class="external-link">as_record_batch_reader</a></span><span class="op">(</span><span class="va">stream</span><span class="op">)</span>, <span class="va">path</span><span class="op">)</span></span>
<span><span class="fu">arrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/docs/r/reference/read_parquet.html" class="external-link">read_parquet</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   n</span></span>
<span><span class="co">## 1 2</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="prepared-queries">Prepared queries<a class="anchor" aria-label="anchor" href="#prepared-queries"></a>
</h2>
<p>The <code><a href="../reference/dbGetQueryArrow.html">dbGetQueryArrow()</a></code> method supports prepared queries,
using the <code>params</code> argument which accepts a data frame or a
list.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">3L</span><span class="op">)</span></span>
<span><span class="va">stream</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetQueryArrow.html">dbGetQueryArrow</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT $a AS batch, * FROM tbl WHERE a &lt; $a"</span>, params <span class="op">=</span> <span class="va">params</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">stream</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   batch a   b    c</span></span>
<span><span class="co">## 1     3 1 4.5 five</span></span>
<span><span class="co">## 2     3 2 4.5 five</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2L</span>, <span class="fl">4L</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Equivalent to dbBind()</span></span>
<span><span class="va">stream</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetQueryArrow.html">dbGetQueryArrow</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT $a AS batch, * FROM tbl WHERE a &lt; $a"</span>, params <span class="op">=</span> <span class="va">params</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">stream</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   batch a   b    c</span></span>
<span><span class="co">## 1     2 1 4.5 five</span></span>
<span><span class="co">## 2     4 1 4.5 five</span></span>
<span><span class="co">## 3     4 2 4.5 five</span></span>
<span><span class="co">## 4     4 3 4.5 five</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="manual-flow">Manual flow<a class="anchor" aria-label="anchor" href="#manual-flow"></a>
</h2>
<p>For the manual flow, use <code><a href="../reference/dbSendQueryArrow.html">dbSendQueryArrow()</a></code> to send a
query to the database, and <code><a href="../reference/dbFetchArrow.html">dbFetchArrow()</a></code> to fetch the
result. This also allows using the new <code><a href="../reference/dbBind.html">dbBindArrow()</a></code> method
to bind data in Arrow format to a prepared query. Result objects must be
cleared with <code><a href="../reference/dbClearResult.html">dbClearResult()</a></code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbSendQueryArrow.html">dbSendQueryArrow</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT $a AS batch, * FROM tbl WHERE a &lt; $a"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">in_arrow</span> <span class="op">&lt;-</span> <span class="fu">nanoarrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/nanoarrow/latest/r/reference/as_nanoarrow_array.html" class="external-link">as_nanoarrow_array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dbBind.html">dbBindArrow</a></span><span class="op">(</span><span class="va">rs</span>, <span class="va">in_arrow</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/dbFetchArrow.html">dbFetchArrow</a></span><span class="op">(</span><span class="va">rs</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] batch a     b     c    </span></span>
<span><span class="co">## &lt;0 rows&gt; (or 0-length row.names)</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">in_arrow</span> <span class="op">&lt;-</span> <span class="fu">nanoarrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/nanoarrow/latest/r/reference/as_nanoarrow_array.html" class="external-link">as_nanoarrow_array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dbBind.html">dbBindArrow</a></span><span class="op">(</span><span class="va">rs</span>, <span class="va">in_arrow</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/dbFetchArrow.html">dbFetchArrow</a></span><span class="op">(</span><span class="va">rs</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   batch a   b    c</span></span>
<span><span class="co">## 1     2 1 4.5 five</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">in_arrow</span> <span class="op">&lt;-</span> <span class="fu">nanoarrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/nanoarrow/latest/r/reference/as_nanoarrow_array.html" class="external-link">as_nanoarrow_array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">3L</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dbBind.html">dbBindArrow</a></span><span class="op">(</span><span class="va">rs</span>, <span class="va">in_arrow</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/dbFetchArrow.html">dbFetchArrow</a></span><span class="op">(</span><span class="va">rs</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   batch a   b    c</span></span>
<span><span class="co">## 1     3 1 4.5 five</span></span>
<span><span class="co">## 2     3 2 4.5 five</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">in_arrow</span> <span class="op">&lt;-</span> <span class="fu">nanoarrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/nanoarrow/latest/r/reference/as_nanoarrow_array.html" class="external-link">as_nanoarrow_array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4L</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dbBind.html">dbBindArrow</a></span><span class="op">(</span><span class="va">rs</span>, <span class="va">in_arrow</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="../reference/dbFetchArrow.html">dbFetchArrow</a></span><span class="op">(</span><span class="va">rs</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   batch a   b    c</span></span>
<span><span class="co">## 1     2 1 4.5 five</span></span>
<span><span class="co">## 2     3 1 4.5 five</span></span>
<span><span class="co">## 3     3 2 4.5 five</span></span>
<span><span class="co">## 4     4 1 4.5 five</span></span>
<span><span class="co">## 5     4 2 4.5 five</span></span>
<span><span class="co">## 6     4 3 4.5 five</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dbClearResult.html">dbClearResult</a></span><span class="op">(</span><span class="va">rs</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="writing-data">Writing data<a class="anchor" aria-label="anchor" href="#writing-data"></a>
</h2>
<p>Streams returned by <code><a href="../reference/dbGetQueryArrow.html">dbGetQueryArrow()</a></code> and
<code><a href="../reference/dbReadTableArrow.html">dbReadTableArrow()</a></code> can be written to a table using
<code><a href="../reference/dbWriteTableArrow.html">dbWriteTableArrow()</a></code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stream</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetQueryArrow.html">dbGetQueryArrow</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT * FROM tbl WHERE a &lt; 3"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dbWriteTableArrow.html">dbWriteTableArrow</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"tbl_new"</span>, <span class="va">stream</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dbReadTable.html">dbReadTable</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"tbl_new"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   a   b    c</span></span>
<span><span class="co">## 1 1 4.5 five</span></span>
<span><span class="co">## 2 2 4.5 five</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="appending-data">Appending data<a class="anchor" aria-label="anchor" href="#appending-data"></a>
</h2>
<p>For more control over the writing process, use
<code><a href="../reference/dbCreateTableArrow.html">dbCreateTableArrow()</a></code> and
<code><a href="../reference/dbAppendTableArrow.html">dbAppendTableArrow()</a></code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stream</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetQueryArrow.html">dbGetQueryArrow</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT * FROM tbl WHERE a &lt; 3"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dbCreateTableArrow.html">dbCreateTableArrow</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"tbl_split"</span>, <span class="va">stream</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dbAppendTableArrow.html">dbAppendTableArrow</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"tbl_split"</span>, <span class="va">stream</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stream</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dbGetQueryArrow.html">dbGetQueryArrow</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT * FROM tbl WHERE a &gt;= 3"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dbAppendTableArrow.html">dbAppendTableArrow</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"tbl_split"</span>, <span class="va">stream</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dbReadTable.html">dbReadTable</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"tbl_split"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   a   b    c</span></span>
<span><span class="co">## 1 1 4.5 five</span></span>
<span><span class="co">## 2 2 4.5 five</span></span>
<span><span class="co">## 3 3 4.5 five</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Do not forget to disconnect from the database when done.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dbDisconnect.html">dbDisconnect</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></code></pre></div>
<p>That concludes the major features of DBI’s new Arrow interface. For
more details on the library functions covered in this tutorial see the
DBI specification at <code><a href="../articles/spec.html">vignette("spec", package = "DBI")</a></code>. See
the <a href="https://adbi.r-dbi.org/" class="external-link">adbi</a> package for a backend
with native Arrow support, and <a href="https://github.com/apache/arrow-nanoarrow" class="external-link">nanoarrow</a> and <a href="https://arrow.apache.org/docs/r/" class="external-link">arrow</a> for packages to work
with the Arrow format.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by R Special Interest Group on Databases (R-SIG-DB), <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://krlmlr.info" class="external-link">Kirill Müller</a>, R Consortium.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
